<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analyseur d'Ouvertures Chess.com</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/cm-chessboard@7.11.0/assets/chessboard.css"
  />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="container">
    <header class="app-header">
      <div class="app-header-icon" aria-hidden="true">♟️</div>
      <div class="app-header-texts">
        <h1>Analyseur d'Ouvertures Chess.com</h1>
        <p class="subtitle">
          Découvrez les ouvertures préférées de n'importe quel joueur et préparez vos parties en quelques minutes.
        </p>
      </div>
    </header>

    <div class="mode-toggle" role="tablist" aria-label="Mode d'analyse">
      <button type="button" class="mode-btn is-active" data-mode="opponent" id="modeOpponent" aria-pressed="true">
        Analyser un adversaire
      </button>
      <button type="button" class="mode-btn" data-mode="self" id="modeSelf" aria-pressed="false">
        M'analyser moi
      </button>
    </div>

    <div class="search-section" id="controlPanel">
      <div class="control-field">
        <label class="control-label" for="username">
          Pseudo Chess.com
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Pseudo du joueur sur Chess.com pour récupérer ses parties publiques."
            data-tooltip="Pseudo du joueur sur Chess.com pour récupérer ses parties publiques."
          >?</span>
        </label>
        <input
          type="text"
          id="username"
          placeholder="Entrez le pseudo Chess.com (ex: hikaru)"
          autocomplete="username"
        />
      </div>
      <div class="control-field">
        <label class="control-label" for="speedSelect">
          Cadence cible
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Choisissez la cadence de jeu pour filtrer les statistiques et recommandations."
            data-tooltip="Choisissez la cadence de jeu pour filtrer les statistiques et recommandations."
          >?</span>
        </label>
        <select id="speedSelect">
          <option value="auto">Auto (selon stats)</option>
          <option value="bullet">Bullet</option>
          <option value="blitz">Blitz</option>
          <option value="rapid">Rapid</option>
          <option value="classical">Classical</option>
          <option value="correspondence">Correspondence</option>
        </select>
      </div>
      <div class="control-field">
        <label class="control-label" for="ratingOffset">
          Décalage Elo Explorer
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Ajuste la plage Elo envoyée à Lichess Explorer pour mieux correspondre au niveau cible."
            data-tooltip="Ajuste la plage Elo envoyée à Lichess Explorer pour mieux correspondre au niveau cible."
          >?</span>
        </label>
        <input type="number" id="ratingOffset" value="0" step="50" />
      </div>
      <div class="control-field">
        <label class="control-label" for="gmMode">
          Théorie GM
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Sélectionnez comment comparer les coups du joueur avec les recommandations de grands maîtres."
            data-tooltip="Sélectionnez comment comparer les coups du joueur avec les recommandations de grands maîtres."
          >?</span>
        </label>
        <select id="gmMode">
          <option value="top1">Top 1</option>
          <option value="topK">Top K</option>
          <option value="coverage">Couverture %</option>
        </select>
      </div>
      <div class="control-field" id="gmTopKField">
        <label class="control-label" for="gmTopK">
          K (Top K)
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Nombre maximum de coups recommandés par les GMs à comparer."
            data-tooltip="Nombre maximum de coups recommandés par les GMs à comparer."
          >?</span>
        </label>
        <input type="number" id="gmTopK" min="1" max="6" value="3" />
      </div>
      <div class="control-field" id="gmCoverageField">
        <label class="control-label" for="gmCoverage">
          Couverture minimale (%)
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Seuil de couverture des coups GM pour valider une recommandation."
            data-tooltip="Seuil de couverture des coups GM pour valider une recommandation."
          >?</span>
        </label>
        <input type="number" id="gmCoverage" min="10" max="100" value="70" step="5" />
      </div>
      <div class="control-field">
        <label class="control-label" for="minMasterGames">
          Volume Masters minimum
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Nombre minimal de parties de maîtres pour qu'une ligne soit considérée fiable."
            data-tooltip="Nombre minimal de parties de maîtres pour qu'une ligne soit considérée fiable."
          >?</span>
        </label>
        <input type="number" id="minMasterGames" min="10" max="500" step="10" value="50" />
      </div>
      <div class="control-field toggle-field" id="engineSettings">
        <span class="control-label">
          Moteur local
          <span
            class="info-bubble"
            tabindex="0"
            role="tooltip"
            aria-label="Active un moteur Stockfish WebAssembly pour évaluer les positions clés directement dans votre navigateur."
            data-tooltip="Active un moteur Stockfish WebAssembly pour évaluer les positions clés directement dans votre navigateur."
          >?</span>
        </span>
        <label class="engine-toggle" for="engineEnabled">
          <input type="checkbox" id="engineEnabled" />
          <span>Activer Stockfish local</span>
        </label>
        <input
          type="text"
          id="enginePath"
          placeholder="Chemin Worker Stockfish (optionnel)"
          autocomplete="off"
          aria-label="Chemin vers le worker Stockfish"
        />
        <div class="engine-options">
          <div class="engine-option">
            <label for="engineDepth">
              Profondeur
              <span
                class="info-bubble"
                tabindex="0"
                role="tooltip"
                aria-label="Nombre de demi-coups analysés par le moteur pour évaluer une position."
                data-tooltip="Nombre de demi-coups analysés par le moteur pour évaluer une position."
              >?</span>
            </label>
            <input type="number" id="engineDepth" min="6" max="30" value="18" />
          </div>
          <div class="engine-option">
            <label for="engineMultiPv">
              MultiPV
              <span
                class="info-bubble"
                tabindex="0"
                role="tooltip"
                aria-label="Nombre de meilleures lignes renvoyées par Stockfish pour comparer les variantes."
                data-tooltip="Nombre de meilleures lignes renvoyées par Stockfish pour comparer les variantes."
              >?</span>
            </label>
            <input type="number" id="engineMultiPv" min="1" max="5" value="3" />
          </div>
        </div>
      </div>
      <button id="analyzeBtn" class="primary-action">Lancer l'analyse</button>
    </div>

    <div id="loading" class="loading">
      ⏳ Chargement des parties en cours...
    </div>

    <div id="error" class="error"></div>

    <div id="playerInfo"></div>

    <div id="prepActions" class="prep-actions">
      <button type="button" id="exportJsonBtn" class="secondary-button">Export JSON</button>
      <button type="button" id="exportMarkdownBtn" class="secondary-button">Export Markdown</button>
      <button type="button" id="exportPdfBtn" class="secondary-button">PDF imprimable</button>
    </div>

    <div id="lichessSelection" class="lichess-selection" aria-live="polite">
      <div class="lichess-selection-info">
        Sélectionnez les ouvertures à enrichir avec Explorer Lichess pour limiter les requêtes
        <span
          class="info-bubble"
          tabindex="0"
          role="tooltip"
          aria-label="L'analyse Lichess Explorer complète les statistiques par couleur avec les bases de données officielles."
          data-tooltip="L'analyse Lichess Explorer complète les statistiques par couleur avec les bases de données officielles."
        >?</span>.
      </div>
      <div class="lichess-selection-actions">
        <span id="lichessSelectionSummary" class="lichess-selection-summary">Blancs : 0 · Noirs : 0</span>
        <button type="button" id="runLichessBtn" class="secondary-button" disabled>
          Analyser les ouvertures sélectionnées
        </button>
        <button type="button" id="resumeLichessBtn" class="secondary-button" hidden>
          Analyser le reste
        </button>
        <span id="lichessCooldownNotice" class="lichess-cooldown-notice" hidden></span>
      </div>
    </div>

    <div id="openingsSection" class="openings-section">
      <div class="openings-card">
        <h3>
          <span class="chess-piece white-piece">♔</span>
          Ouvertures avec les Blancs
        </h3>
        <div id="whiteOpenings"></div>
      </div>

      <div class="openings-card">
        <h3>
          <span class="chess-piece black-piece">♚</span>
          Ouvertures avec les Noirs
        </h3>
        <div id="blackOpenings"></div>
      </div>
    </div>

    <section
      id="duelModeRoot"
      class="duel-mode-section"
      aria-label="Mode Duel Chess.com"
    ></section>
  </div>

  <div id="boardPreview">
    <div
      id="boardPreviewBoard"
      class="board-preview-board"
      aria-hidden="true"
    ></div>
    <div class="board-preview-caption" id="boardPreviewCaption"></div>
  </div>

  <div
    id="lineModal"
    class="line-modal"
    role="dialog"
    aria-modal="true"
    aria-hidden="true"
  >
    <div class="line-modal-dialog">
      <div class="line-modal-header">
        <div class="line-modal-title" id="lineModalTitle">Séquence</div>
        <button
          type="button"
          class="line-modal-close"
          id="lineModalClose"
          aria-label="Fermer"
        >
          ×
        </button>
      </div>
      <div class="line-modal-content">
        <div class="line-modal-board" id="lineModalBoard" aria-hidden="false"></div>
        <div class="line-modal-sidebar">
          <div class="line-modal-subtitle" id="lineModalSummary"></div>
          <div class="line-modal-controls">
            <button type="button" id="lineModalStart">⏮ Début</button>
            <button type="button" id="lineModalPrev">◀️ Précédent</button>
            <button type="button" id="lineModalNext">▶️ Suivant</button>
            <button type="button" id="lineModalEnd">⏭ Fin</button>
          </div>
          <div class="line-modal-moves" id="lineModalMoves"></div>
        </div>
      </div>
      <div class="line-modal-footer">
        <a
          href="https://lichess.org/analysis"
          target="_blank"
          rel="noopener"
          id="lineModalLichess"
          class="line-modal-link"
        >
          ↗ Voir la position sur Lichess
        </a>
      </div>
    </div>
  </div>

  <script type="module" src="./src/app.js"></script>

</body>

</html>
